pipeline {
   agent any
   environment {
    image_name = ''
   }

      stage('Publish') {
          steps{
              script {
                  image_name = "app" + ":$BUILD_NUMBER"
                  dockerImage = docker.build(image_name,"--network  host -f app/Dockerfile .")
              }
          }
      }

      stage ('Deploy') {
          steps {
              script{
              echo image_name
              sh "ansible-playbook app/playbook.yaml --extra-vars \"image=${image_name}\"
              }
          }
      }




   }
}
